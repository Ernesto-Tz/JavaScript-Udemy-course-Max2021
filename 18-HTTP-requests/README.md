# HTTP requests

When a http request is sent to load a website what files are sent by the server?
The application is hosted on the server and running there, then what files are get by the browser?

What happens is that the browser sends a request to the server, the first file to arrived will be the html file, then the CSS and at the end probably the JavaScript file. The browser is in charge of interpreting and displaying all the information included. On the metadata of the request we can find which type of file it is getting (pdf, html, etc). Find more [here](https://academind.com/tutorials/how-the-web-works).

Routes or also called entry points from an application. They are the API points of connection.

## GET request

It starts by creating a new XML Http request object, it is supported by all browsers. This object allows us to create the request.

Then we need to configure the request:
1. Call the open method from the `XMLHttp` object. It is only the first step, no network activity is started.
2. Define `.open()` arguments; first is the type of request (GET, POST, etc.), second is the url.
3. Send the request


```JavaScript
const xhr = new XMLHttpRequest();

xhr.open('GET','https://jsonplaceholder.typicode.com/posts');

xhr.send();
```

The information get on the response is in a JSON format most of the time, however, we can't modify that data unless we parse it. For that we have 2 options:

* Manually parse the response using `JSON.parse()`
* Set the response type to JSON.

```Javascript
const xhr = new XMLHttpRequest();

xhr.open('GET','https://jsonplaceholder.typicode.com/posts');

// Version 1
const listOfPosts = JSON.parse(xhr.response);
console.log(listOfPosts);

// Version 2
xhr.responseType = 'json';
const listOfPosts2 = xhr.response;
console.log(listOfPosts2);

xhr.send();
```

> we have to define the type of response specifically as `'json'`. Manual parsing is widely supported.

## POST request

Additionally to the steps needed on the `GET` request we will also need a body for the request this means that when we send the request we need to include the body inside, this information needs to be included as a JSON object by using `stringify()`:

```JavaScript
xhr.send(JSON.stringify(body));
```

## DELETE request

Depending on which type of request the API supports we will be able to use those request. Not all APIs support `delete`.

It usually will require the id of the element on the url, this means we need to insert that information when we create the request we do so by using double backtick **`** and in order to insert the id (wrap the id on **${}**) of the element:

```JavaScript
listElements.addEventListener('click', event => {
    if (event.target.tagName === 'BUTTON'){
        const postId =  event.target.closest('li').id;
        sendHttpRequest('DELETE',`https://jsonplaceholder.typicode.com/posts/${postId}`)
    }
})
```

## Http request status

Http request can failed for many reasons (invalid data, bad connection, bad path, etc.). There is a list of usual responses sent back by the server when a request was successful or if there was an error:

1. **(100 - 199) Informational**: The server has received the request and is continuing the process. Purely temporary, for most tasks you won't encounter these much, as it's not the final response to the request.
2. **(200 - 299) Successful**: The request was successful and the browser has received the expected information.
3. **(300 - 399) Redirection**: You have been redirected and the completion of the request requires further action. A redirect means that the request was received successfully, but that the resource was found elsewhere. If a webpage has changed path and you try to access it through the old path, your CMS will often redirect the user to the new path.
4. **(400 - 499) Client Error**: The website or the page could not be reached, either the page is unavailable or the request contains bad syntax.
5. **(500 - 599) Server Error**: While the request appears to be valid, the server could not complete the request.

*Find more information about http status on [MDN](https://developer.mozilla.org/en-US/docs/Web/HTTP/Status) or [umbraco](https://umbraco.com/knowledge-base/http-status-codes/)*.

## Debugging request

We can open developer tools and on the network tab we can see all the requests generated by the application. First we will probably see the `index.html`, `styles.css`, `app.js` and then we can see other request such as `GET` request and see the content, header, etc.

On the code we can catch those errors by using promises or the try-catch structure. Additionally we can use a predefined event listener => `.onerror` which requires a function.

### `.onerror event listener

This event listener will kick in when the request fails to be sent (network error, time-out, etc.). A 404 error indicates that the request was successful but the path used is not found (this is technically a successful request with a reject response).   

The `XMLHttpRequest()` object allows us to see the status of the response. Based on that we can also check if the request failed or succeeded:

```JavaScript
    xhr.onload = function() {
        if(xhr.status >= 200 && xhr.status < 300){
            resolve(xhr.response);
        }
        else {
            reject(new Error("This is a costume error message"))
        }
    };
```

## fetch() API

It is a more modern API but not all browsers are using it.

It works around the `fetch()` function.   
In the simplest form it takes an url and it will create a request with that.
It gives an stream response 